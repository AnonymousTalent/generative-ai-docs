# 每小時自動同步 Notion DB 至 CSV 並 commit 回 GitHub
# cron: '0 * * * *'      # 每小時執行
# 可自訂：https://crontab.guru

name: Auto Sync Notion Settlement Tracker
on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:
jobs:
  sync_notion_to_csv:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install deps
        run: pip install notion-client pandas
      - name: Export Notion → CSV
        env:
          NOTION_TOKEN: $ secrets.NOTION_TOKEN 
          NOTION_DATABASE_ID: $ secrets.NOTION_DATABASE_ID 
        run: python scripts/notion_export_csv.py
      - name: Commit & push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "actions@github.com"
          git add exported_settlement_tracker.csv
          git diff --cached --quiet && echo "No changes" || (git commit -m "Auto-sync Notion Settlement Tracker CSV" && git push)
